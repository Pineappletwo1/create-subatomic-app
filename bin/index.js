#! /usr/bin/env node

// DO NOT EDIT THIS FILE, THIS FILE IS FOR CREATING SUBATOMIC PROJECTS, EDITING THE FILE MAY CAUSE PROBLEMS

const select = require('cli-select');
const chalk = require('chalk');
const readline = require('readline');
const { execSync } = require('child_process');

async function main() {
    const rl = readline.createInterface({
        input: process.stdin,
        output: process.stdout
    });

    rl.question('What is the name of your app? ', (appName) => {
        console.log(`Your app's name is: ${appName}`);
        rl.close();

        console.log('Would you like to use Tailwind?');

        const tailwindOptions = {
            values: ['Yes', 'No'],
            valueRenderer: (value, selected) => {
                if (selected) {
                    return chalk.hex('#800080')(`* ${value}`); // Purple color for selected option
                }

                return `  ${value}`;
            },
        };

        select(tailwindOptions)
            .then(tailwindResponse => {
                console.log('Would you like to use TypeScript?');

                const typescriptOptions = {
                    values: ['Yes', 'No'],
                    valueRenderer: (value, selected) => {
                        if (selected) {
                            return chalk.hex('#800080')(`* ${value}`); // Purple color for selected option
                        }

                        return `  ${value}`;
                    },
                };

                select(typescriptOptions)
                    .then(typescriptResponse => {
                        let repoUrl;
                        if (tailwindResponse.value === 'Yes' && typescriptResponse.value === 'No') {
                            repoUrl = 'https://github.com/TheLazyCodernothacker/Subatomic.git';
                        } else if (tailwindResponse.value === 'No' && typescriptResponse.value === 'Yes') {
                            repoUrl = 'https://github.com/Subatomic-Team/Subatomic-ts';
                        } else if (tailwindResponse.value === 'No' && typescriptResponse.value === 'No') {
                            repoUrl = 'https://github.com/Subatomic-Team/Subatomic-notailwind';
                        } else {
                            console.log('Coming soon, please select another option and restart by running npx create-subatomic-app');
                            return;
                        }

                        // Clone the repository
                        execSync(`git clone ${repoUrl} ${appName}`);

                        // Change directory to the cloned repository
                        process.chdir(appName);

                        // Install the dependencies
                        console.log('Installing libraries...');
                        execSync('npm i', { stdio: 'ignore' });
                        console.log("finished installing libraries")

                        console.log(chalk.blue('Please run "npm run start" to get started'));
                    })
                    .catch(() => {
                        console.log('No option was selected.');
                    });
            })
            .catch(() => {
                console.log('No option was selected.');
            });
    });
}

main();